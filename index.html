<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Threads - Social Platform</title>
<style>
    :root {
        --bg-primary: #000;
        --bg-secondary: #111;
        --bg-tertiary: #1a1a1a;
        --text-primary: #fff;
        --text-secondary: #666;
        --border-color: #333;
        --accent-color: #1d9bf0;
        --accent-hover: #1a8cd8;
        --like-color: #f91880;
        --repost-color: #00ba7c;
        --success-color: #4caf50;
        --error-color: #e91e63;
        --warning-color: #ff9800;
        --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    [data-theme="light"] {
        --bg-primary: #fff;
        --bg-secondary: #f8f9fa;
        --bg-tertiary: #e9ecef;
        --text-primary: #000;
        --text-secondary: #666;
        --border-color: #e1e8ed;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        padding-bottom: 80px;
        transition: all 0.3s ease;
        overflow-x: hidden;
    }

    /* Header */
    .header {
        background: var(--bg-primary);
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        backdrop-filter: blur(10px);
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .threads-logo {
        width: 32px;
        height: 32px;
        background: var(--gradient);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.2rem;
        cursor: pointer;
    }

    .header h1 {
        color: var(--text-primary);
        font-size: 1.5rem;
        font-weight: 700;
    }

    .header-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .search-btn, .chat-btn, .login-btn, .theme-toggle, .notifications-btn {
        background: none;
        border: none;
        color: var(--text-primary);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        transition: all 0.2s;
        position: relative;
    }

    .theme-toggle {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
    }

    .login-btn {
        background: var(--accent-color);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .login-btn:hover {
        background: var(--accent-hover);
    }

    .search-btn:hover, .chat-btn:hover, .theme-toggle:hover, .notifications-btn:hover {
        background: var(--bg-tertiary);
    }

    /* Connection Status */
    .connection-status {
        position: fixed;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--bg-secondary);
        color: var(--text-primary);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        border: 1px solid var(--border-color);
        font-size: 0.8rem;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .connection-status.show {
        opacity: 1;
        visibility: visible;
    }

    .connection-status.online {
        border-color: var(--success-color);
        color: var(--success-color);
    }

    .connection-status.offline {
        border-color: var(--warning-color);
        color: var(--warning-color);
    }

    .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: currentColor;
    }

    /* Notification Badge */
    .notification-badge {
        position: absolute;
        top: 0;
        right: 0;
        background: var(--error-color);
        color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    /* Sidebar */
    .sidebar {
        position: fixed;
        left: 0;
        top: 70px;
        width: 250px;
        height: calc(100vh - 70px);
        background: var(--bg-primary);
        border-right: 1px solid var(--border-color);
        padding: 1rem;
        overflow-y: auto;
        z-index: 50;
        transition: all 0.3s ease;
    }

    .sidebar-nav {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .sidebar-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.8rem;
        border-radius: 12px;
        color: var(--text-primary);
        text-decoration: none;
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
    }

    .sidebar-item:hover, .sidebar-item.active {
        background: var(--bg-tertiary);
    }

    .sidebar-icon {
        width: 24px;
        height: 24px;
        fill: currentColor;
    }

    .sidebar-label {
        font-size: 1rem;
        font-weight: 500;
    }

    /* Main Layout */
    .main-layout {
        display: flex;
        max-width: 1200px;
        margin: 0 auto;
        min-height: calc(100vh - 70px);
    }

    .content-area {
        flex: 1;
        margin-left: 250px;
        border-right: 1px solid var(--border-color);
        min-height: calc(100vh - 70px);
        transition: all 0.3s ease;
    }

    .right-sidebar {
        width: 300px;
        padding: 1rem;
        background: var(--bg-primary);
    }

    /* Hashtags */
    .hashtag {
        color: var(--accent-color);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
    }

    .hashtag:hover {
        text-decoration: underline;
    }

    /* Main Content */
    .main-content {
        padding: 0;
    }

    .content-header {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        background: var(--bg-primary);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 70px;
        z-index: 40;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .content-header h2 {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .back-btn {
        background: none;
        border: none;
        color: var(--text-primary);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        transition: all 0.2s;
        margin-right: 1rem;
    }

    .back-btn:hover {
        background: var(--bg-tertiary);
    }

    /* User Info */
    .user-info {
        background: var(--bg-secondary);
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .user-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease;
        background-size: cover;
        background-position: center;
    }

    .user-avatar:hover {
        transform: scale(1.05);
    }

    .user-details {
        flex: 1;
    }

    .user-name {
        font-weight: 600;
        margin-bottom: 0.2rem;
    }

    .user-handle {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .logout-btn {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        padding: 0.4rem 0.8rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.2s ease;
    }

    .logout-btn:hover {
        background: var(--border-color);
    }

    /* Profile Page */
    .profile-page {
        display: none;
    }

    .profile-page.active {
        display: block;
    }

    .profile-header {
        background: var(--bg-secondary);
        padding: 2rem 1rem 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    .profile-cover {
        height: 200px;
        background: var(--gradient);
        border-radius: 12px;
        margin-bottom: 1rem;
        position: relative;
    }

    .profile-avatar-large {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: var(--gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
        font-weight: 600;
        border: 4px solid var(--bg-primary);
        position: absolute;
        bottom: -60px;
        left: 1rem;
        background-size: cover;
        background-position: center;
    }

    .profile-info {
        margin-top: 60px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .profile-details h1 {
        font-size: 1.5rem;
        margin-bottom: 0.2rem;
    }

    .profile-handle {
        color: var(--text-secondary);
        margin-bottom: 1rem;
    }

    .profile-bio {
        margin-bottom: 1rem;
        line-height: 1.4;
    }

    .profile-stats {
        display: flex;
        gap: 2rem;
        margin-bottom: 1rem;
    }

    .stat {
        text-align: center;
        cursor: pointer;
    }

    .stat-number {
        font-weight: 700;
        font-size: 1.2rem;
    }

    .stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .profile-actions {
        display: flex;
        gap: 1rem;
    }

    .follow-btn, .edit-profile-btn {
        padding: 0.5rem 1.5rem;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        font-size: 0.9rem;
    }

    .follow-btn {
        background: var(--accent-color);
        color: white;
    }

    .follow-btn:hover {
        background: var(--accent-hover);
    }

    .follow-btn.following {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .edit-profile-btn {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .edit-profile-btn:hover {
        background: var(--border-color);
    }

    .profile-tabs {
        display: flex;
        border-bottom: 1px solid var(--border-color);
    }

    .profile-tab {
        flex: 1;
        padding: 1rem;
        text-align: center;
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
        border-bottom: 2px solid transparent;
    }

    .profile-tab.active {
        color: var(--text-primary);
        border-bottom-color: var(--accent-color);
    }

    /* Compose Section */
    .compose-section {
        background: var(--bg-primary);
        padding: 1rem;
        border-bottom: 8px solid var(--bg-secondary);
    }

    .compose-header {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .compose-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        flex-shrink: 0;
        background-size: cover;
        background-position: center;
    }

    .compose-input {
        width: 100%;
        background: transparent;
        border: none;
        color: var(--text-primary);
        font-size: 1.2rem;
        resize: none;
        min-height: 80px;
        outline: none;
        font-family: inherit;
    }

    .compose-input::placeholder {
        color: var(--text-secondary);
    }

    .image-preview-container {
        margin-top: 1rem;
        display: none;
        position: relative;
    }

    .image-preview {
        max-width: 100%;
        max-height: 400px;
        border-radius: 12px;
        object-fit: cover;
    }

    .remove-image {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .compose-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
    }

    .compose-tools {
        display: flex;
        gap: 1rem;
    }

    .tool-btn {
        background: none;
        border: none;
        color: var(--accent-color);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        transition: all 0.2s;
        position: relative;
    }

    .tool-btn:hover {
        background: rgba(29, 155, 240, 0.1);
    }

    .file-input {
        display: none;
    }

    .post-btn {
        background: var(--accent-color);
        color: white;
        padding: 0.5rem 1.5rem;
        border: none;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9rem;
    }

    .post-btn:hover {
        background: var(--accent-hover);
    }

    .post-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Posts */
    .posts-container {
        background: var(--bg-primary);
    }

    .post {
        background: var(--bg-primary);
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
    }

    .post:hover {
        background: var(--bg-secondary);
    }

    .post.repost {
        border-left: 3px solid var(--repost-color);
    }

    .repost-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .repost-icon {
        color: var(--repost-color);
    }

    .post-header {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 0.5rem;
    }

    .post-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        cursor: pointer;
        flex-shrink: 0;
        transition: transform 0.2s ease;
        background-size: cover;
        background-position: center;
    }

    .post-avatar:hover {
        transform: scale(1.05);
    }

    .post-main {
        flex: 1;
        min-width: 0;
    }

    .post-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }

    .post-info h4 {
        margin: 0;
        font-size: 0.95rem;
        color: var(--text-primary);
        cursor: pointer;
        font-weight: 600;
    }

    .post-info h4:hover {
        text-decoration: underline;
    }

    .post-handle {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 400;
    }

    .post-time {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .post-content {
        color: var(--text-primary);
        line-height: 1.4;
        margin-bottom: 1rem;
        font-size: 1rem;
        word-wrap: break-word;
    }

    .post-image {
        max-width: 100%;
        border-radius: 12px;
        margin-top: 1rem;
        cursor: pointer;
    }

    .post-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 425px;
        margin-top: 1rem;
    }

    .action-btn {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem;
        border-radius: 20px;
        transition: all 0.2s;
        font-size: 0.9rem;
    }

    .action-btn:hover {
        background: var(--bg-tertiary);
    }

    .action-btn.comment:hover {
        color: var(--accent-color);
        background: rgba(29, 155, 240, 0.1);
    }

    .action-btn.liked, .action-btn.like:hover {
        color: var(--like-color);
        background: rgba(249, 24, 128, 0.1);
    }

    .action-btn.reposted, .action-btn.repost:hover {
        color: var(--repost-color);
        background: rgba(0, 186, 124, 0.1);
    }

    /* Thread View */
    .thread-view {
        display: none;
    }

    .thread-view.active {
        display: block;
    }

    .thread-line {
        position: absolute;
        left: 20px;
        top: 60px;
        bottom: 0;
        width: 2px;
        background: var(--border-color);
    }

    .thread-post {
        position: relative;
    }

    .thread-post:last-child .thread-line {
        display: none;
    }

    .reply-form {
        background: var(--bg-secondary);
        padding: 1rem;
        border-top: 1px solid var(--border-color);
    }

    /* Auth Modal */
    .auth-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .auth-modal.show {
        opacity: 1;
        visibility: visible;
    }

    .auth-container {
        background: var(--bg-secondary);
        padding: 2rem;
        border-radius: 16px;
        max-width: 400px;
        width: 90%;
        border: 1px solid var(--border-color);
        position: relative;
        transform: scale(0.9);
        transition: all 0.3s ease;
    }

    .auth-modal.show .auth-container {
        transform: scale(1);
    }

    .close-auth {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: none;
        border: none;
        color: var(--text-primary);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
    }

    .auth-tabs {
        display: flex;
        margin-bottom: 1.5rem;
        border-radius: 8px;
        background: var(--bg-tertiary);
        padding: 4px;
    }

    .auth-tab {
        flex: 1;
        padding: 0.6rem;
        text-align: center;
        border: none;
        background: transparent;
        color: var(--text-primary);
        cursor: pointer;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .auth-tab.active {
        background: var(--accent-color);
        color: white;
    }

    .auth-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
    }

    .form-group label {
        font-weight: 500;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .form-group input, .form-group textarea {
        padding: 0.8rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 1rem;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        transition: all 0.2s ease;
        font-family: inherit;
        resize: vertical;
    }

    .form-group input:focus, .form-group textarea:focus {
        outline: none;
        border-color: var(--accent-color);
    }

    .auth-btn {
        background: var(--accent-color);
        color: white;
        padding: 0.8rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .auth-btn:hover {
        background: var(--accent-hover);
    }

    .auth-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* Welcome Banner */
    .welcome-banner {
        background: var(--gradient);
        padding: 2rem;
        text-align: center;
        color: white;
        margin-bottom: 1rem;
    }

    .welcome-banner h2 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
    }

    .welcome-banner p {
        opacity: 0.9;
        margin-bottom: 1rem;
    }

    .cta-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 0.8rem 1.5rem;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .cta-btn:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    /* Loading */
    .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid var(--border-color);
        border-top: 2px solid var(--accent-color);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Notifications */
    .notification {
        position: fixed;
        top: 80px;
        right: 1rem;
        background: var(--bg-secondary);
        color: var(--text-primary);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        z-index: 1000;
        max-width: 300px;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.error {
        border-left: 4px solid var(--error-color);
    }

    .notification.success {
        border-left: 4px solid var(--success-color);
    }

    .notification.info {
        border-left: 4px solid var(--accent-color);
    }

    /* Search Modal */
    .search-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding-top: 5rem;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .search-modal.show {
        opacity: 1;
        visibility: visible;
    }

    .search-container {
        background: var(--bg-secondary);
        padding: 1rem;
        border-radius: 16px;
        max-width: 500px;
        width: 90%;
        border: 1px solid var(--border-color);
    }

    .search-input {
        width: 100%;
        padding: 1rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        font-size: 1rem;
        outline: none;
    }

    .search-results {
        margin-top: 1rem;
        max-height: 400px;
        overflow-y: auto;
    }

    .search-result {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
        transition: all 0.2s;
    }

    .search-result:hover {
        background: var(--bg-tertiary);
    }

    .hidden { display: none; }

    /* Responsive */
    @media (max-width: 1024px) {
        .sidebar {
            width: 80px;
        }
        
        .content-area {
            margin-left: 80px;
        }
        
        .sidebar-label {
            display: none;
        }
        
        .right-sidebar {
            display: none;
        }
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            width: 250px;
            z-index: 200;
        }
        
        .sidebar.mobile-open {
            transform: translateX(0);
        }
        
        .content-area {
            margin-left: 0;
        }
        
        .main-layout {
            flex-direction: column;
        }
        
        .auth-container {
            margin: 1rem;
            padding: 1.5rem;
        }

        .header-left h1 {
            font-size: 1.2rem;
        }

        .compose-input {
            font-size: 1.1rem;
        }

        .post {
            padding: 0.8rem;
        }

        .connection-status {
            font-size: 0.7rem;
            padding: 0.3rem 0.8rem;
        }

        .profile-cover {
            height: 150px;
        }

        .profile-avatar-large {
            width: 80px;
            height: 80px;
            font-size: 1.5rem;
            bottom: -40px;
        }

        .profile-info {
            margin-top: 40px;
        }

        .profile-stats {
            gap: 1rem;
        }
    }

    /* Mobile Overlay */
    .mobile-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 150;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .mobile-overlay.show {
        opacity: 1;
        visibility: visible;
    }

    /* Trending Section */
    .trending-section, .suggestions-section {
        background: var(--bg-secondary);
        border-radius: 16px;
        margin-bottom: 1rem;
        overflow: hidden;
    }

    .section-header {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    .section-title {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .trending-item, .suggestion-item {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
        transition: all 0.2s;
    }

    .trending-item:hover, .suggestion-item:hover {
        background: var(--bg-tertiary);
    }

    .trending-item:last-child, .suggestion-item:last-child {
        border-bottom: none;
    }

    .trending-category {
        color: var(--text-secondary);
        font-size: 0.8rem;
        margin-bottom: 0.2rem;
    }

    .trending-topic {
        font-weight: 600;
        margin-bottom: 0.2rem;
    }

    .trending-posts {
        color: var(--text-secondary);
        font-size: 0.8rem;
    }

    .suggestion-item {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .suggestion-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
    }

    .suggestion-info {
        flex: 1;
    }

    .suggestion-name {
        font-weight: 600;
        margin-bottom: 0.2rem;
    }

    .suggestion-handle {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .follow-btn-small {
        background: var(--accent-color);
        color: white;
        border: none;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.2s ease;
    }

    .follow-btn-small:hover {
        background: var(--accent-hover);
    }
</style>
</head>
<body data-theme="dark">
<!-- Connection Status -->
<div class="connection-status" id="connectionStatus">
    <div class="status-indicator"></div>
    <span id="connectionText">Connecting...</span>
</div>

<!-- Header -->
<header class="header">
    <div class="header-left">
        <div class="threads-logo" onclick="toggleMobileSidebar()">@</div>
        <h1>Threads</h1>
    </div>
    <div class="header-actions">
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" id="themeIcon">
                <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8z"/>
            </svg>
        </button>
        <button class="search-btn" onclick="openSearch()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
        </button>
        <button class="notifications-btn" onclick="toggleNotifications()" id="notificationsBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
            </svg>
            <span class="notification-badge hidden" id="notificationsBadge">0</span>
        </button>
        <button class="login-btn" onclick="openAuth()" id="loginBtn">Log in</button>
    </div>
</header>

<!-- Mobile Overlay -->
<div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileSidebar()"></div>

<!-- Sidebar -->
<nav class="sidebar" id="sidebar">
    <div class="sidebar-nav">
        <a href="#" class="sidebar-item active" onclick="setActiveSection(this, 'home')">
            <svg class="sidebar-icon" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            <span class="sidebar-label">Home</span>
        </a>
        <a href="#" class="sidebar-item" onclick="setActiveSection(this, 'search')">
            <svg class="sidebar-icon" viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
            <span class="sidebar-label">Explore</span>
        </a>
        <a href="#" class="sidebar-item" onclick="setActiveSection(this, 'notifications')">
            <svg class="sidebar-icon" viewBox="0 0 24 24">
                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
            </svg>
            <span class="sidebar-label">Notifications</span>
        </a>
        <a href="#" class="sidebar-item" onclick="setActiveSection(this, 'profile')">
            <svg class="sidebar-icon" viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <span class="sidebar-label">Profile</span>
        </a>
    </div>
</nav>

<!-- Main Layout -->
<div class="main-layout">
    <!-- Content Area -->
    <main class="content-area">
        <!-- Home View -->
        <div class="main-content" id="homeView">
            <!-- Content Header -->
            <div class="content-header">
                <h2>Home</h2>
            </div>

            <!-- User Info (when logged in) -->
            <div class="user-info hidden" id="userInfo">
                <div class="user-avatar" id="userAvatar" onclick="showProfile()"></div>
                <div class="user-details">
                    <div class="user-name" id="userName">Welcome!</div>
                    <div class="user-handle" id="userHandle">@user</div>
                </div>
                <button class="logout-btn" onclick="logout()">Sign Out</button>
            </div>

            <!-- Welcome Banner (when not logged in) -->
            <div class="welcome-banner" id="welcomeBanner">
                <h2>Welcome to Threads</h2>
                <p>Join the conversation and connect with people around the world</p>
                <button class="cta-btn" onclick="openAuth()">Join Threads today</button>
            </div>

            <!-- Compose Section (when logged in) -->
            <div class="compose-section hidden" id="composeSection">
                <div class="compose-header">
                    <div class="compose-avatar" id="composeAvatar"></div>
                    <div style="flex: 1;">
                        <textarea class="compose-input" id="composeInput" placeholder="What's happening?"></textarea>
                        <div class="image-preview-container" id="imagePreviewContainer">
                            <img class="image-preview" id="imagePreview" alt="Preview">
                            <button class="remove-image" onclick="removeImage()">Ã—</button>
                        </div>
                    </div>
                </div>
                <div class="compose-actions">
                    <div class="compose-tools">
                        <button class="tool-btn" onclick="document.getElementById('imageInput').click()" title="Add image">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                            </svg>
                        </button>
                        <button class="tool-btn" onclick="addHashtag()" title="Add hashtag">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9.5 4H11.5L10.5 9H15.5L16.5 4H18.5L17.5 9H22V11H17L16 16H21V18H15.5L14.5 23H12.5L13.5 18H8.5L7.5 23H5.5L6.5 18H2V16H7L8 11H3V9H8.5L9.5 4ZM10 11L9 16H14L15 11H10Z"/>
                            </svg>
                        </button>
                        <input type="file" id="imageInput" class="file-input" accept="image/*" onchange="handleImageUpload(event)">
                    </div>
                    <button class="post-btn" id="postBtn" onclick="createPost()">Post</button>
                </div>
            </div>

            <!-- Posts Container -->
            <div class="posts-container" id="postsContainer">
                <!-- Posts will be loaded here -->
            </div>
        </div>

        <!-- Profile View -->
        <div class="profile-page" id="profileView">
            <div class="content-header">
                <button class="back-btn" onclick="showHome()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </button>
                <h2 id="profileTitle">Profile</h2>
            </div>
            
            <div class="profile-header">
                <div class="profile-cover">
                    <div class="profile-avatar-large" id="profileAvatarLarge"></div>
                </div>
                <div class="profile-info">
                    <div class="profile-details">
                        <h1 id="profileName">User Name</h1>
                        <div class="profile-handle" id="profileHandleText">@username</div>
                        <div class="profile-bio" id="profileBio">Bio goes here...</div>
                        <div class="profile-stats">
                            <div class="stat" onclick="showFollowers()">
                                <div class="stat-number" id="followersCount">0</div>
                                <div class="stat-label">Followers</div>
                            </div>
                            <div class="stat" onclick="showFollowing()">
                                <div class="stat-number" id="followingCount">0</div>
                                <div class="stat-label">Following</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="postsCount">0</div>
                                <div class="stat-label">Posts</div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-actions" id="profileActions">
                        <button class="edit-profile-btn" onclick="editProfile()">Edit Profile</button>
                    </div>
                </div>
            </div>

            <div class="profile-tabs">
                <button class="profile-tab active" onclick="switchProfileTab(this, 'posts')">Posts</button>
                <button class="profile-tab" onclick="switchProfileTab(this, 'replies')">Replies</button>
                <button class="profile-tab" onclick="switchProfileTab(this, 'reposts')">Reposts</button>
                <button class="profile-tab" onclick="switchProfileTab(this, 'likes')">Likes</button>
            </div>

            <div class="posts-container" id="profilePostsContainer">
                <!-- Profile posts will be loaded here -->
            </div>
        </div>

        <!-- Thread View -->
        <div class="thread-view" id="threadView">
            <div class="content-header">
                <button class="back-btn" onclick="showHome()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </button>
                <h2>Thread</h2>
            </div>
            
            <div class="posts-container" id="threadContainer">
                <!-- Thread posts will be loaded here -->
            </div>

            <div class="reply-form hidden" id="replyForm">
                <div class="compose-header">
                    <div class="compose-avatar" id="replyAvatar"></div>
                    <textarea class="compose-input" id="replyInput" placeholder="Post your reply..."></textarea>
                </div>
                <div class="compose-actions">
                    <div class="compose-tools">
                        <button class="tool-btn" onclick="document.getElementById('replyImageInput').click()" title="Add image">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                            </svg>
                        </button>
                        <input type="file" id="replyImageInput" class="file-input" accept="image/*">
                    </div>
                    <button class="post-btn" onclick="postReply()">Reply</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Right Sidebar -->
    <aside class="right-sidebar">
        <!-- Trending Section -->
        <div class="trending-section">
            <div class="section-header">
                <h3 class="section-title">What's happening</h3>
            </div>
            <div class="trending-item" onclick="filterByHashtag('AI')">
                <div class="trending-category">Trending in Technology</div>
                <div class="trending-topic">#AI</div>
                <div class="trending-posts">125K posts</div>
            </div>
            <div class="trending-item" onclick="filterByHashtag('WebDevelopment')">
                <div class="trending-category">Trending</div>
                <div class="trending-topic">#WebDevelopment</div>
                <div class="trending-posts">89K posts</div>
            </div>
            <div class="trending-item" onclick="filterByHashtag('JavaScript')">
                <div class="trending-category">Technology Â· Trending</div>
                <div class="trending-topic">JavaScript</div>
                <div class="trending-posts">67K posts</div>
            </div>
        </div>

        <!-- Suggestions Section -->
        <div class="suggestions-section">
            <div class="section-header">
                <h3 class="section-title">Who to follow</h3>
            </div>
            <div class="suggestion-item" onclick="showUserProfile('johndoe')">
                <div class="suggestion-avatar">J</div>
                <div class="suggestion-info">
                    <div class="suggestion-name">John Doe</div>
                    <div class="suggestion-handle">@johndoe</div>
                </div>
                <button class="follow-btn-small" onclick="followUser('johndoe', event)">Follow</button>
            </div>
            <div class="suggestion-item" onclick="showUserProfile('sarahw')">
                <div class="suggestion-avatar">S</div>
                <div class="suggestion-info">
                    <div class="suggestion-name">Sarah Wilson</div>
                    <div class="suggestion-handle">@sarahw</div>
                </div>
                <button class="follow-btn-small" onclick="followUser('sarahw', event)">Follow</button>
            </div>
        </div>
    </aside>
</div>

<!-- Search Modal -->
<div class="search-modal" id="searchModal">
    <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="Search for people and posts..." onkeyup="performSearch()">
        <div class="search-results" id="searchResults">
            <!-- Search results will appear here -->
        </div>
    </div>
</div>

<!-- Auth Modal -->
<div class="auth-modal" id="authModal">
    <div class="auth-container">
        <button class="close-auth" onclick="closeAuth()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
        </button>
        
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchTab('login')">Sign In</button>
            <button class="auth-tab" onclick="switchTab('register')">Sign Up</button>
        </div>

        <!-- Login Form -->
        <form class="auth-form" id="loginForm">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="auth-btn" id="loginBtnForm">Sign In</button>
        </form>

        <!-- Register Form -->
        <form class="auth-form hidden" id="registerForm">
            <div class="form-group">
                <label for="registerName">Full Name</label>
                <input type="text" id="registerName" required>
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" required minlength="6">
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" required minlength="6">
            </div>
            <div class="form-group">
                <label for="registerBio">Bio (optional)</label>
                <textarea id="registerBio" placeholder="Tell us about yourself..."></textarea>
            </div>
            <button type="submit" class="auth-btn" id="registerBtn">Create Account</button>
        </form>
    </div>
</div>

<!-- Firebase SDKs -->
<script type="module">
    // Import Firebase modules - Updated to v10.11.0 for better compatibility
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, onSnapshot, doc, updateDoc, arrayUnion, arrayRemove, serverTimestamp, where, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';
    import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js';

    // Your Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCd0TIh01C1-7QrhsAP6eXlhIa8FqqgpkQ",
        authDomain: "threads-news-68771.firebaseapp.com",
        projectId: "threads-news-68771",
        storageBucket: "threads-news-68771.appspot.com",
        messagingSenderId: "68771954012",
        appId: "1:68771954012:android:f5620bff494f14a1ae5599"
    };

    // Initialize Firebase with enhanced error handling
    let app, auth, db, storage;
    let isFirebaseConnected = false;

    try {
        console.log('ðŸ”¥ Initializing Firebase...');
        app = initializeApp(firebaseConfig);
        auth = getAuth(app);
        db = getFirestore(app);
        storage = getStorage(app);
        
        // Test Firebase connection with a simple operation
        const testConnection = new Promise((resolve, reject) => {
            const timeout = setTimeout(() => reject(new Error('Connection timeout')), 10000);
            const unsubscribe = onAuthStateChanged(auth, (user) => {
                clearTimeout(timeout);
                unsubscribe();
                resolve(user);
            }, reject);
        });
        
        await testConnection;
        
        isFirebaseConnected = true;
        updateConnectionStatus('online', 'Connected to Firebase');
        console.log('ðŸ”¥ Firebase initialized successfully');
        console.log('ðŸ“Š Project ID:', firebaseConfig.projectId);
        console.log('ðŸ” Auth Domain:', firebaseConfig.authDomain);
    } catch (error) {
        console.warn('âš ï¸ Firebase initialization failed, using localStorage only:', error);
        updateConnectionStatus('offline', 'Offline mode - ' + error.message);
        isFirebaseConnected = false;
    }

    // Global variables
    window.auth = auth;
    window.db = db;
    window.storage = storage;
    window.isFirebaseConnected = isFirebaseConnected;

    // App State
    let currentUser = null;
    let currentTab = 'login';
    let selectedImage = null;
    let currentHashtagFilter = null;
    let unsubscribePosts = null;
    let currentView = 'home';
    let currentProfileUser = null;
    let currentThread = null;

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ðŸš€ Complete Threads app with all features initialized');
        
        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
        
        // Load sample posts immediately
        loadSamplePosts();
        
        // Check for saved user and Firebase auth state
        if (isFirebaseConnected) {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || user.email.split('@')[0],
                        photoURL: user.photoURL,
                        bio: ''
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    await loadUserProfile();
                    showUserInterface(currentUser);
                    loadPosts();
                    setupRealtimeListeners();
                } else {
                    currentUser = null;
                    localStorage.removeItem('currentUser');
                    showGuestInterface();
                    if (unsubscribePosts) {
                        unsubscribePosts();
                        unsubscribePosts = null;
                    }
                }
            });
        } else {
            // Fallback to localStorage
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showUserInterface(currentUser);
                loadPosts();
            } else {
                showGuestInterface();
            }
        }
        
        // Initialize form handlers
        initFormHandlers();
        
        // Hide connection status after 3 seconds
        setTimeout(() => {
            document.getElementById('connectionStatus').classList.remove('show');
        }, 3000);

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('search-modal')) {
                closeSearch();
            }
            if (e.target.classList.contains('auth-modal')) {
                closeAuth();
            }
        });
    });

    // Connection status
    function updateConnectionStatus(status, text) {
        const statusEl = document.getElementById('connectionStatus');
        const textEl = document.getElementById('connectionText');
        
        statusEl.className = `connection-status ${status} show`;
        textEl.textContent = text;
    }

    // Theme Management
    function toggleTheme() {
        const body = document.body;
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
        
        showNotification(`Switched to ${newTheme} theme`, 'success');
    }

    function updateThemeIcon(theme) {
        const themeIcon = document.getElementById('themeIcon');
        if (theme === 'light') {
            themeIcon.innerHTML = '<path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>';
        } else {
            themeIcon.innerHTML = '<path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8z"/>';
        }
    }

    // Navigation Functions
    function showHome() {
        currentView = 'home';
        document.getElementById('homeView').style.display = 'block';
        document.getElementById('profileView').classList.remove('active');
        document.getElementById('threadView').classList.remove('active');
        loadPosts();
    }

    function showProfile(userId = null) {
        currentView = 'profile';
        currentProfileUser = userId || (currentUser ? currentUser.uid : null);
        document.getElementById('homeView').style.display = 'none';
        document.getElementById('profileView').classList.add('active');
        document.getElementById('threadView').classList.remove('active');
        loadProfileData();
    }

    function showThread(postId) {
        currentView = 'thread';
        currentThread = postId;
        document.getElementById('homeView').style.display = 'none';
        document.getElementById('profileView').classList.remove('active');
        document.getElementById('threadView').classList.add('active');
        loadThreadData(postId);
    }

    function showUserProfile(username) {
        showProfile(username);
    }

    // Image Upload Functions
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            selectedImage = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imagePreviewContainer').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    function removeImage() {
        selectedImage = null;
        document.getElementById('imagePreviewContainer').style.display = 'none';
        document.getElementById('imageInput').value = '';
    }

    async function uploadImage(file) {
        if (!isFirebaseConnected || !file) return null;
        
        try {
            const storageRef = ref(storage, `images/${Date.now()}_${file.name}`);
            const snapshot = await uploadBytes(storageRef, file);
            const downloadURL = await getDownloadURL(snapshot.ref);
            return downloadURL;
        } catch (error) {
            console.error('Error uploading image:', error);
            showNotification('Failed to upload image', 'error');
            return null;
        }
    }

    // Hashtag Functions
    function parseHashtags(text) {
        return text.replace(/#(\w+)/g, '<a href="#" class="hashtag" onclick="filterByHashtag(\'$1\')">#$1</a>');
    }

    function filterByHashtag(hashtag) {
        currentHashtagFilter = hashtag;
        document.querySelector('.content-header h2').textContent = `#${hashtag}`;
        loadPosts();
        showNotification(`Showing posts for #${hashtag}`, 'info');
    }

    function addHashtag() {
        const input = document.getElementById('composeInput');
        const hashtags = ['#AI', '#WebDevelopment', '#JavaScript', '#React', '#TechNews', '#Programming'];
        const randomHashtag = hashtags[Math.floor(Math.random() * hashtags.length)];
        input.value += ` ${randomHashtag}`;
        input.focus();
    }

    // User Interface Management
    function showUserInterface(user) {
        document.getElementById('welcomeBanner').classList.add('hidden');
        document.getElementById('userInfo').classList.remove('hidden');
        document.getElementById('composeSection').classList.remove('hidden');
        document.getElementById('loginBtn').textContent = 'Profile';
        
        const avatar = (user.displayName || user.email).charAt(0).toUpperCase();
        document.getElementById('userName').textContent = user.displayName || 'User';
        document.getElementById('userHandle').textContent = `@${(user.displayName || user.email.split('@')[0]).toLowerCase().replace(/\s+/g, '')}`;
        
        // Set avatars
        const userAvatar = document.getElementById('userAvatar');
        const composeAvatar = document.getElementById('composeAvatar');
        const replyAvatar = document.getElementById('replyAvatar');
        
        if (user.photoURL) {
            userAvatar.style.backgroundImage = `url(${user.photoURL})`;
            userAvatar.textContent = '';
            composeAvatar.style.backgroundImage = `url(${user.photoURL})`;
            composeAvatar.textContent = '';
            if (replyAvatar) {
                replyAvatar.style.backgroundImage = `url(${user.photoURL})`;
                replyAvatar.textContent = '';
            }
        } else {
            userAvatar.textContent = avatar;
            composeAvatar.textContent = avatar;
            if (replyAvatar) replyAvatar.textContent = avatar;
        }
    }

    function showGuestInterface() {
        document.getElementById('welcomeBanner').classList.remove('hidden');
        document.getElementById('userInfo').classList.add('hidden');
        document.getElementById('composeSection').classList.add('hidden');
        document.getElementById('loginBtn').textContent = 'Log in';
    }

    // Profile Functions
    async function loadUserProfile() {
        if (!currentUser || !isFirebaseConnected) return;
        
        try {
            const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
            if (userDoc.exists()) {
                const userData = userDoc.data();
                currentUser = { ...currentUser, ...userData };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                console.log('âœ… User profile loaded from Firestore');
            } else {
                // Create user document if it doesn't exist
                await setDoc(doc(db, 'users', currentUser.uid), {
                    uid: currentUser.uid,
                    displayName: currentUser.displayName,
                    email: currentUser.email,
                    bio: '',
                    followers: [],
                    following: [],
                    photoURL: currentUser.photoURL,
                    createdAt: serverTimestamp()
                });
                console.log('âœ… User profile created in Firestore');
            }
        } catch (error) {
            console.error('âŒ Error loading user profile:', error);
            showNotification('Error loading profile data', 'error');
        }
    }

    async function loadProfileData() {
        if (!currentProfileUser) return;
        
        const isOwnProfile = currentUser && currentProfileUser === currentUser.uid;
        
        if (isOwnProfile) {
            document.getElementById('profileName').textContent = currentUser.displayName || 'User';
            document.getElementById('profileHandleText').textContent = `@${(currentUser.displayName || currentUser.email.split('@')[0]).toLowerCase().replace(/\s+/g, '')}`;
            document.getElementById('profileBio').textContent = currentUser.bio || 'No bio yet.';
            
            const avatar = (currentUser.displayName || currentUser.email).charAt(0).toUpperCase();
            const profileAvatar = document.getElementById('profileAvatarLarge');
            
            if (currentUser.photoURL) {
                profileAvatar.style.backgroundImage = `url(${currentUser.photoURL})`;
                profileAvatar.textContent = '';
            } else {
                profileAvatar.textContent = avatar;
            }
            
            document.getElementById('profileActions').innerHTML = '<button class="edit-profile-btn" onclick="editProfile()">Edit Profile</button>';
        } else {
            document.getElementById('profileName').textContent = 'John Doe';
            document.getElementById('profileHandleText').textContent = '@johndoe';
            document.getElementById('profileBio').textContent = 'Software developer passionate about creating amazing user experiences.';
            document.getElementById('profileAvatarLarge').textContent = 'J';
            document.getElementById('profileActions').innerHTML = '<button class="follow-btn" onclick="toggleFollow()">Follow</button>';
        }
        
        // Load profile stats
        document.getElementById('followersCount').textContent = Math.floor(Math.random() * 1000);
        document.getElementById('followingCount').textContent = Math.floor(Math.random() * 500);
        document.getElementById('postsCount').textContent = Math.floor(Math.random() * 100);
        
        loadProfilePosts();
    }

    function loadProfilePosts() {
        const profileContainer = document.getElementById('profilePostsContainer');
        profileContainer.innerHTML = '';
        
        const mockPosts = [
            {
                id: 'profile1',
                userName: currentUser ? currentUser.displayName : 'John Doe',
                content: 'Working on some exciting new features! ðŸš€ #coding #webdev',
                createdAt: { seconds: Date.now() / 1000 - 3600 },
                likes: [],
                comments: [],
                reposts: []
            }
        ];
        
        mockPosts.forEach(post => {
            const postElement = createPostElement(post, false);
            profileContainer.appendChild(postElement);
        });
    }

    function switchProfileTab(tab, type) {
        document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} tab selected`, 'info');
    }

    function editProfile() {
        showNotification('Edit profile feature coming soon!', 'info');
    }

    function toggleFollow() {
        const btn = event.target;
        if (btn.textContent === 'Follow') {
            btn.textContent = 'Following';
            btn.classList.add('following');
            showNotification('Now following this user!', 'success');
        } else {
            btn.textContent = 'Follow';
            btn.classList.remove('following');
            showNotification('Unfollowed user', 'info');
        }
    }

    // Posts Management
    function loadSamplePosts() {
        const samplePosts = [
            {
                id: 'sample1',
                userName: 'Alex Johnson',
                userHandle: '@alexj',
                content: 'Just launched my new web app! ðŸš€ Built with modern JavaScript and loving the performance improvements. #WebDevelopment #JavaScript',
                createdAt: { seconds: Date.now() / 1000 - 3600 },
                likes: [],
                comments: [],
                reposts: [],
                avatar: 'A'
            },
            {
                id: 'sample2',
                userName: 'Sarah Chen',
                userHandle: '@sarahc',
                content: 'Beautiful sunset from my office window today. Sometimes you need to pause and appreciate the simple moments. ðŸŒ…',
                createdAt: { seconds: Date.now() / 1000 - 7200 },
                likes: [],
                comments: [],
                reposts: [],
                avatar: 'S',
                imageUrl: '/placeholder.svg?height=300&width=400'
            },
            {
                id: 'sample3',
                userName: 'Tech News',
                userHandle: '@technews',
                content: 'BREAKING: New #AI breakthrough announced! Researchers have developed a more efficient neural network architecture. #TechNews',
                createdAt: { seconds: Date.now() / 1000 - 10800 },
                likes: [],
                comments: [],
                reposts: [],
                avatar: 'T'
            }
        ];

        const postsContainer = document.getElementById('postsContainer');
        postsContainer.innerHTML = '';
        
        samplePosts.forEach(post => {
            const postElement = createPostElement(post, true);
            postsContainer.appendChild(postElement);
        });
        
        console.log('ðŸ“± Loaded sample posts');
    }

    async function loadPosts() {
        try {
            let posts = [];
            
            if (isFirebaseConnected && currentUser) {
                const postsQuery = query(
                    collection(db, 'posts'),
                    orderBy('createdAt', 'desc'),
                    limit(20)
                );
                
                const querySnapshot = await getDocs(postsQuery);
                posts = querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
            } else {
                posts = JSON.parse(localStorage.getItem('userPosts') || '[]');
            }
            
            if (currentHashtagFilter) {
                posts = posts.filter(post => 
                    post.content && post.content.toLowerCase().includes(`#${currentHashtagFilter.toLowerCase()}`)
                );
            }
            
            const postsContainer = document.getElementById('postsContainer');
            postsContainer.innerHTML = '';
            
            if (posts.length === 0 && currentHashtagFilter) {
                postsContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <h3>No posts found for #${currentHashtagFilter}</h3>
                        <p>Be the first to post about this topic!</p>
                        <button class="auth-btn" onclick="clearHashtagFilter()" style="margin-top: 1rem;">View all posts</button>
                    </div>
                `;
                return;
            }
            
            posts.forEach(post => {
                const postElement = createPostElement(post, false);
                postsContainer.appendChild(postElement);
            });
            
            if (posts.length === 0 && !currentHashtagFilter) {
                loadSamplePosts();
            }
            
        } catch (error) {
            console.error('âŒ Error loading posts:', error);
            loadSamplePosts();
        }
    }

    function createPostElement(post, isSample = false) {
        const postDiv = document.createElement('div');
        postDiv.className = 'post';
        if (post.isRepost) postDiv.classList.add('repost');
        postDiv.setAttribute('data-post-id', post.id);
        
        const createdAt = post.createdAt ? new Date(post.createdAt.seconds * 1000) : new Date();
        const timeAgo = getTimeAgo(createdAt);
        const isLiked = post.likes && post.likes.includes(currentUser?.uid || 'guest');
        const isReposted = post.reposts && post.reposts.includes(currentUser?.uid || 'guest');
        const likesCount = post.likes ? post.likes.length : 0;
        const repostsCount = post.reposts ? post.reposts.length : 0;
        const commentsCount = post.comments ? post.comments.length : 0;
        const avatar = isSample ? post.avatar : (post.userName || 'U').charAt(0).toUpperCase();
        const handle = isSample ? post.userHandle : `@${(post.userName || 'user').toLowerCase().replace(/\s+/g, '')}`;
        
        let repostHeader = '';
        if (post.isRepost && post.repostedBy) {
            repostHeader = `
                <div class="repost-header">
                    <svg class="repost-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M23.77 15.67c-.292-.293-.767-.293-1.06 0l-2.22 2.22V7.65c0-2.068-1.683-3.75-3.75-3.75h-5.85c-.414 0-.75.336-.75.75s.336.75.75.75h5.85c1.24 0 2.25 1.01 2.25 2.25v10.24l-2.22-2.22c-.293-.293-.768-.293-1.061 0s-.293.768 0 1.061l3.5 3.5c.145.147.337.22.53.22s.383-.072.53-.22l3.5-3.5c.294-.292.294-.767.001-1.06zm-10.66 3.28H7.26c-1.24 0-2.25-1.01-2.25-2.25V6.46l2.22 2.22c.148.147.34.22.532.22s.384-.073.53-.22c.293-.293.293-.768 0-1.061l-3.5-3.5c-.293-.294-.768-.294-1.061 0l-3.5 3.5c-.294.292-.294.767 0 1.06s.767.294 1.06 0l2.22-2.22V16.7c0 2.068 1.683 3.75 3.75 3.75h5.85c.414 0 .75-.336.75-.75s-.337-.75-.75-.75z"/>
                    </svg>
                    ${post.repostedBy} reposted
                </div>
            `;
        }
        
        const imageHtml = post.imageUrl ? `<img src="${post.imageUrl}" alt="Post image" class="post-image" onclick="openImageModal('${post.imageUrl}')">` : '';
        
        postDiv.innerHTML = `
            ${repostHeader}
            <div class="post-header">
                <div class="post-avatar" onclick="showUserProfile('${post.userId || 'sample'}')">${avatar}</div>
                <div class="post-main">
                    <div class="post-info">
                        <h4 onclick="showUserProfile('${post.userId || 'sample'}')">${post.userName || 'Anonymous'}</h4>
                        <span class="post-handle">${handle}</span>
                        <span class="post-time">Â· ${timeAgo}</span>
                    </div>
                    <div class="post-content" onclick="showThread('${post.id}')">${parseHashtags(post.content || '')}</div>
                    ${imageHtml}
                    <div class="post-actions">
                        <button class="action-btn comment" onclick="showThread('${post.id}')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h11c.55 0 1-.45 1-1z"/>
                            </svg>
                            ${commentsCount}
                        </button>
                        <button class="action-btn ${isReposted ? 'reposted' : 'repost'}" onclick="${isSample ? 'promptLogin()' : `toggleRepost('${post.id}')`}">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M23.77 15.67c-.292-.293-.767-.293-1.06 0l-2.22 2.22V7.65c0-2.068-1.683-3.75-3.75-3.75h-5.85c-.414 0-.75.336-.75.75s.336.75.75.75h5.85c1.24 0 2.25 1.01 2.25 2.25v10.24l-2.22-2.22c-.293-.293-.768-.293-1.061 0s-.293.768 0 1.061l3.5 3.5c.145.147.337.22.53.22s.383-.072.53-.22l3.5-3.5c.294-.292.294-.767.001-1.06zm-10.66 3.28H7.26c-1.24 0-2.25-1.01-2.25-2.25V6.46l2.22 2.22c.148.147.34.22.532.22s.384-.073.53-.22c.293-.293.293-.768 0-1.061l-3.5-3.5c-.293-.294-.768-.294-1.061 0l-3.5 3.5c-.294.292-.294.767 0 1.06s.767.294 1.06 0l2.22-2.22V16.7c0 2.068 1.683 3.75 3.75 3.75h5.85c.414 0 .75-.336.75-.75s-.337-.75-.75-.75z"/>
                            </svg>
                            ${repostsCount}
                        </button>
                        <button class="action-btn ${isLiked ? 'liked' : 'like'}" onclick="${isSample ? 'promptLogin()' : `toggleLike('${post.id}')`}">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                            ${likesCount}
                        </button>
                        <button class="action-btn share" onclick="sharePost('${post.id}')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        return postDiv;
    }

    function getTimeAgo(date) {
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        
        if (diffInSeconds < 60) return `${diffInSeconds}s`;
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h`;
        return `${Math.floor(diffInSeconds / 86400)}d`;
    }

    // Thread Functions
    function loadThreadData(postId) {
        const threadContainer = document.getElementById('threadContainer');
        threadContainer.innerHTML = '';
        
        const mainPost = {
            id: postId,
            userName: 'Alex Johnson',
            userHandle: '@alexj',
            content: 'This is the main post that started the thread. What do you think about this topic?',
            createdAt: { seconds: Date.now() / 1000 - 3600 },
            likes: [1, 2, 3],
            comments: [1, 2],
            reposts: [1],
            avatar: 'A'
        };
        
        const replies = [
            {
                id: 'reply1',
                userName: 'Sarah Chen',
                userHandle: '@sarahc',
                content: 'Great point! I totally agree with your perspective on this.',
                createdAt: { seconds: Date.now() / 1000 - 1800 },
                likes: [1],
                comments: [],
                reposts: [],
                avatar: 'S',
                isReply: true
            },
            {
                id: 'reply2',
                userName: 'Mike Wilson',
                userHandle: '@mikew',
                content: 'Interesting take. Have you considered the alternative approach?',
                createdAt: { seconds: Date.now() / 1000 - 900 },
                likes: [],
                comments: [],
                reposts: [],
                avatar: 'M',
                isReply: true
            }
        ];
        
        const mainPostElement = createPostElement(mainPost, true);
        mainPostElement.classList.add('thread-post');
        threadContainer.appendChild(mainPostElement);
        
        replies.forEach(reply => {
            const replyElement = createPostElement(reply, true);
            replyElement.classList.add('thread-post');
            threadContainer.appendChild(replyElement);
        });
        
        if (currentUser) {
            document.getElementById('replyForm').classList.remove('hidden');
        }
    }

    function postReply() {
        if (!currentUser) {
            promptLogin();
            return;
        }
        
        const content = document.getElementById('replyInput').value.trim();
        if (!content) {
            showNotification('Please add some content to your reply', 'error');
            return;
        }
        
        showNotification('Reply posted successfully!', 'success');
        document.getElementById('replyInput').value = '';
        loadThreadData(currentThread);
    }

    // Post Actions
    async function createPost() {
        if (!currentUser) {
            promptLogin();
            return;
        }

        const content = document.getElementById('composeInput').value.trim();
        const postBtn = document.getElementById('postBtn');
        
        if (!content) {
            showNotification('Please add some content', 'error');
            return;
        }
        
        postBtn.innerHTML = '<span class="loading"></span>';
        postBtn.disabled = true;
        
        try {
            let imageUrl = null;
            if (selectedImage) {
                imageUrl = await uploadImage(selectedImage);
            }
            
            const newPost = {
                userId: currentUser.uid,
                userName: currentUser.displayName || 'User',
                userEmail: currentUser.email,
                content: content,
                imageUrl: imageUrl,
                likes: [],
                comments: [],
                reposts: [],
                createdAt: isFirebaseConnected ? serverTimestamp() : { seconds: Date.now() / 1000 }
            };
            
            if (isFirebaseConnected) {
                await addDoc(collection(db, 'posts'), newPost);
            } else {
                newPost.id = 'post_' + Date.now();
                newPost.createdAt = { seconds: Date.now() / 1000 };
                const posts = JSON.parse(localStorage.getItem('userPosts') || '[]');
                posts.unshift(newPost);
                localStorage.setItem('userPosts', JSON.stringify(posts));
            }
            
            document.getElementById('composeInput').value = '';
            removeImage();
            loadPosts();
            
            showNotification('Post shared successfully!', 'success');
            console.log('âœ… Post created by:', currentUser.email);
        } catch (error) {
            console.error('âŒ Create post error:', error);
            showNotification('Failed to create post. Please try again.', 'error');
        } finally {
            postBtn.innerHTML = 'Post';
            postBtn.disabled = false;
        }
    }

    async function toggleLike(postId) {
        if (!currentUser) {
            promptLogin();
            return;
        }
        
        try {
            if (isFirebaseConnected) {
                const postRef = doc(db, 'posts', postId);
                const postDoc = await getDoc(postRef);
                
                if (postDoc.exists()) {
                    const postData = postDoc.data();
                    const likes = postData.likes || [];
                    
                    if (likes.includes(currentUser.uid)) {
                        await updateDoc(postRef, {
                            likes: arrayRemove(currentUser.uid)
                        });
                    } else {
                        await updateDoc(postRef, {
                            likes: arrayUnion(currentUser.uid)
                        });
                        showNotification('Post liked!', 'success');
                    }
                    loadPosts();
                }
            } else {
                const posts = JSON.parse(localStorage.getItem('userPosts') || '[]');
                const postIndex = posts.findIndex(p => p.id === postId);
                
                if (postIndex !== -1) {
                    const post = posts[postIndex];
                    const likes = post.likes || [];
                    
                    if (likes.includes(currentUser.uid)) {
                        post.likes = likes.filter(uid => uid !== currentUser.uid);
                    } else {
                        post.likes = [...likes, currentUser.uid];
                        showNotification('Post liked!', 'success');
                    }
                    
                    localStorage.setItem('userPosts', JSON.stringify(posts));
                    loadPosts();
                }
            }
        } catch (error) {
            console.error('âŒ Toggle like error:', error);
            showNotification('Failed to update like', 'error');
        }
    }

    async function toggleRepost(postId) {
        if (!currentUser) {
            promptLogin();
            return;
        }
        
        try {
            if (isFirebaseConnected) {
                const postRef = doc(db, 'posts', postId);
                const postDoc = await getDoc(postRef);
                
                if (postDoc.exists()) {
                    const postData = postDoc.data();
                    const reposts = postData.reposts || [];
                    
                    if (reposts.includes(currentUser.uid)) {
                        await updateDoc(postRef, {
                            reposts: arrayRemove(currentUser.uid)
                        });
                        showNotification('Repost removed', 'info');
                    } else {
                        await updateDoc(postRef, {
                            reposts: arrayUnion(currentUser.uid)
                        });
                        showNotification('Post reposted!', 'success');
                    }
                    loadPosts();
                }
            } else {
                const posts = JSON.parse(localStorage.getItem('userPosts') || '[]');
                const postIndex = posts.findIndex(p => p.id === postId);
                
                if (postIndex !== -1) {
                    const post = posts[postIndex];
                    const reposts = post.reposts || [];
                    
                    if (reposts.includes(currentUser.uid)) {
                        post.reposts = reposts.filter(uid => uid !== currentUser.uid);
                        showNotification('Repost removed', 'info');
                    } else {
                        post.reposts = [...reposts, currentUser.uid];
                        showNotification('Post reposted!', 'success');
                        
                        const repost = {
                            ...post,
                            id: 'repost_' + Date.now(),
                            isRepost: true,
                            repostedBy: currentUser.displayName || currentUser.email.split('@')[0],
                            createdAt: { seconds: Date.now() / 1000 }
                        };
                        posts.unshift(repost);
                    }
                    
                    localStorage.setItem('userPosts', JSON.stringify(posts));
                    loadPosts();
                }
            }
        } catch (error) {
            console.error('âŒ Toggle repost error:', error);
            showNotification('Failed to update repost', 'error');
        }
    }

    // Search Functions
    function openSearch() {
        document.getElementById('searchModal').classList.add('show');
        document.getElementById('searchInput').focus();
    }

    function closeSearch() {
        document.getElementById('searchModal').classList.remove('show');
        document.getElementById('searchInput').value = '';
        document.getElementById('searchResults').innerHTML = '';
    }

    function performSearch() {
        const query = document.getElementById('searchInput').value.trim();
        const resultsContainer = document.getElementById('searchResults');
        
        if (!query) {
            resultsContainer.innerHTML = '';
            return;
        }
        
        const mockResults = [
            { type: 'user', name: 'John Doe', handle: '@johndoe', avatar: 'J' },
            { type: 'user', name: 'Sarah Wilson', handle: '@sarahw', avatar: 'S' },
            { type: 'hashtag', tag: '#WebDevelopment', posts: '89K posts' },
            { type: 'hashtag', tag: '#JavaScript', posts: '67K posts' }
        ];
        
        const filteredResults = mockResults.filter(result => 
            result.name?.toLowerCase().includes(query.toLowerCase()) ||
            result.handle?.toLowerCase().includes(query.toLowerCase()) ||
            result.tag?.toLowerCase().includes(query.toLowerCase())
        );
        
        resultsContainer.innerHTML = '';
        
        filteredResults.forEach(result => {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'search-result';
            
            if (result.type === 'user') {
                resultDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">${result.avatar}</div>
                        <div>
                            <div style="font-weight: 600;">${result.name}</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">${result.handle}</div>
                        </div>
                    </div>
                `;
                resultDiv.onclick = () => {
                    showUserProfile(result.handle.substring(1));
                    closeSearch();
                };
            } else if (result.type === 'hashtag') {
                resultDiv.innerHTML = `
                    <div>
                        <div style="font-weight: 600; color: var(--accent-color);">${result.tag}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">${result.posts}</div>
                    </div>
                `;
                resultDiv.onclick = () => {
                    filterByHashtag(result.tag.substring(1));
                    closeSearch();
                    showHome();
                };
            }
            
            resultsContainer.appendChild(resultDiv);
        });
    }

    // Setup real-time listeners
    function setupRealtimeListeners() {
        if (!isFirebaseConnected || !currentUser) return;
        
        try {
            const postsQuery = query(
                collection(db, 'posts'),
                orderBy('createdAt', 'desc'),
                limit(20)
            );
            
            unsubscribePosts = onSnapshot(postsQuery, (snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added') {
                        console.log('ðŸ“± New post added:', change.doc.data());
                    }
                });
                
                if (currentView === 'home') {
                    loadPosts();
                }
            });
        } catch (error) {
            console.error('âŒ Error setting up real-time listeners:', error);
        }
    }

    // Authentication Functions
    function openAuth() {
        if (currentUser) {
            showProfile();
        } else {
            document.getElementById('authModal').classList.add('show');
        }
    }

    function closeAuth() {
        document.getElementById('authModal').classList.remove('show');
    }

    function promptLogin() {
        showNotification('Please sign in to interact with posts', 'error');
        setTimeout(() => openAuth(), 1000);
    }

    function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
        document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
        
        if (tab === 'login') {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        } else {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }
    }

    // Form Handlers
    function initFormHandlers() {
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtnForm');
            
            btn.innerHTML = '<span class="loading"></span> Signing in...';
            btn.disabled = true;
            
            try {
                if (isFirebaseConnected) {
                    await signInWithEmailAndPassword(auth, email, password);
                    showNotification('Welcome back to Threads!', 'success');
                } else {
                    const user = {
                        uid: 'user_' + Date.now(),
                        email: email,
                        displayName: email.split('@')[0],
                        photoURL: null,
                        bio: ''
                    };
                    
                    currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    showUserInterface(user);
                    showNotification('Welcome back to Threads!', 'success');
                }
                
                closeAuth();
                loadPosts();
                console.log('âœ… User signed in:', email);
            } catch (error) {
                console.error('âŒ Login error:', error);
                showNotification('Invalid credentials', 'error');
            } finally {
                btn.innerHTML = 'Sign In';
                btn.disabled = false;
            }
        });

        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const bio = document.getElementById('registerBio').value;
            const btn = document.getElementById('registerBtn');
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            btn.innerHTML = '<span class="loading"></span> Creating account...';
            btn.disabled = true;
            
            try {
                if (isFirebaseConnected) {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await updateProfile(userCredential.user, {
                        displayName: name
                    });
                    
                    await setDoc(doc(db, 'users', userCredential.user.uid), {
                        uid: userCredential.user.uid,
                        displayName: name,
                        email: email,
                        bio: bio,
                        followers: [],
                        following: [],
                        photoURL: null,
                        createdAt: serverTimestamp()
                    });
                    
                    showNotification('Welcome to Threads! Account created successfully!', 'success');
                } else {
                    const user = {
                        uid: 'user_' + Date.now(),
                        email: email,
                        displayName: name,
                        photoURL: null,
                        bio: bio
                    };
                    
                    currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    showUserInterface(user);
                    showNotification('Welcome to Threads! Account created successfully!', 'success');
                }
                
                closeAuth();
                console.log('âœ… New user registered:', email);
            } catch (error) {
                console.error('âŒ Registration error:', error);
                let errorMessage = 'Registration failed';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email already in use';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak';
                }
                showNotification(errorMessage, 'error');
            } finally {
                btn.innerHTML = 'Create Account';
                btn.disabled = false;
            }
        });
    }

    async function logout() {
        try {
            if (isFirebaseConnected) {
                await signOut(auth);
            } else {
                currentUser = null;
                localStorage.removeItem('currentUser');
                showGuestInterface();
                loadSamplePosts();
            }
            
            showNotification('Signed out successfully', 'success');
            console.log('âœ… User signed out');
        } catch (error) {
            console.error('âŒ Logout error:', error);
            showNotification('Error signing out', 'error');
        }
    }

    // Utility Functions
    function sharePost(postId) {
        if (navigator.share) {
            navigator.share({
                title: 'Check out this post on Threads',
                text: 'Interesting post I found on Threads',
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(window.location.href);
            showNotification('Link copied to clipboard!', 'success');
        }
    }

    function followUser(username, event) {
        if (event) event.stopPropagation();
        
        if (!currentUser) {
            promptLogin();
            return;
        }
        
        const btn = event.target;
        if (btn.textContent === 'Follow') {
            btn.textContent = 'Following';
            btn.classList.add('following');
            showNotification(`Following @${username}!`, 'success');
        } else {
            btn.textContent = 'Follow';
            btn.classList.remove('following');
            showNotification(`Unfollowed @${username}`, 'info');
        }
    }

    function clearHashtagFilter() {
        currentHashtagFilter = null;
        document.querySelector('.content-header h2').textContent = 'Home';
        loadPosts();
    }

    function showFollowers() {
        showNotification('Followers list coming soon!', 'info');
    }

    function showFollowing() {
        showNotification('Following list coming soon!', 'info');
    }

    function toggleNotifications() {
        showNotification('Notifications feature coming soon!', 'info');
    }

    function openImageModal(imageUrl) {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        `;
        
        const img = document.createElement('img');
        img.src = imageUrl;
        img.style.cssText = `
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        `;
        
        modal.appendChild(img);
        document.body.appendChild(modal);
        
        modal.onclick = () => document.body.removeChild(modal);
    }

    function setActiveSection(element, section) {
        document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
        element.classList.add('active');
        
        if (section === 'home') {
            showHome();
            clearHashtagFilter();
        } else if (section === 'profile') {
            if (currentUser) {
                showProfile();
            } else {
                promptLogin();
            }
        } else if (section === 'search') {
            openSearch();
        } else {
            showNotification(`${section.charAt(0).toUpperCase() + section.slice(1)} feature coming soon!`, 'info');
        }
    }

    function toggleMobileSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('mobileOverlay');
        
        sidebar.classList.toggle('mobile-open');
        overlay.classList.toggle('show');
    }

    function closeMobileSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('mobileOverlay');
        
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('show');
    }

    // Notification System
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type} show`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    // Make functions globally available
    window.toggleTheme = toggleTheme;
    window.showHome = showHome;
    window.showProfile = showProfile;
    window.showThread = showThread;
    window.showUserProfile = showUserProfile;
    window.handleImageUpload = handleImageUpload;
    window.removeImage = removeImage;
    window.openAuth = openAuth;
    window.closeAuth = closeAuth;
    window.switchTab = switchTab;
    window.logout = logout;
    window.createPost = createPost;
    window.toggleLike = toggleLike;
    window.toggleRepost = toggleRepost;
    window.sharePost = sharePost;
    window.followUser = followUser;
    window.filterByHashtag = filterByHashtag;
    window.clearHashtagFilter = clearHashtagFilter;
    window.addHashtag = addHashtag;
    window.loadProfileData = loadProfileData;
    window.switchProfileTab = switchProfileTab;
    window.editProfile = editProfile;
    window.toggleFollow = toggleFollow;
    window.showFollowers = showFollowers;
    window.showFollowing = showFollowing;
    window.postReply = postReply;
    window.openSearch = openSearch;
    window.closeSearch = closeSearch;
    window.performSearch = performSearch;
    window.openImageModal = openImageModal;
    window.toggleNotifications = toggleNotifications;
    window.setActiveSection = setActiveSection;
    window.toggleMobileSidebar = toggleMobileSidebar;
    window.closeMobileSidebar = closeMobileSidebar;
    window.promptLogin = promptLogin;
    window.showNotification = showNotification;
</script>
</body>
</html>